**Class:** `com.android.apksig.SigningCertificateLineage`

| Topic | Summary |
|-------|---------|
| **Main purpose / role** | Represents the *certificate lineage* for an APK that is signed using the V3 (or newer) signing scheme.  It is essentially a linked‑list of “signing certificate nodes” that capture the sequence of certificates that have signed a given APK over time.  The class is responsible for:<br>•  Building a lineage from scratch or by “spawning” a descendant from an existing lineage.<br>•  Serialising / deserialising the lineage to/from the binary representation that is stored in the APK’s signing block, in a file, or as a raw byte array.<br>•  Providing helper methods that expose the certificates, capabilities and flags that belong to each node, and allowing callers to query whether a particular cert or signer is part of the lineage.<br>•  Consolidating multiple lineages (e.g., when an APK is signed with several independent V3 signatures).<br>In short, the class is the model object that holds and manipulates the “history” of signing certificates for an APK. |
| **Importance in the application** | **Core** – This class is a fundamental building block of the V3 signing workflow.  It is used by the `ApkSignerTool`, `SignerParams`, the internal `V3SchemeVerifier`/`V3SchemeSigner`, and the stamp‑verifier (`V2SourceStampSigner`).  Without a reliable lineage representation, the system cannot support certificate roll‑over or the “forward‑compatible” signing model that Android introduced in API level 24+. |
| **Context and use case** | <ul> <li>**Creating a new lineage** – When a new APK is signed, `createSigningLineage()` is called with the parent/child signer configs and capabilities.  The resulting lineage is embedded in the APK’s signing block.  <li>**Verifying an APK** – During signature verification, the verifier reads the lineage (via `readFromApkFile`, `readFromFile`, etc.), reconstructs the chain of certificates, and checks that each node’s capabilities and flags satisfy the verification rules.  <li>**Updating a certificate** – If the developer rotates the signing certificate, the signer can “spawn” a descendant lineage using the existing lineage as the parent, which automatically records the old cert and updates the min‑SDK and flags.  <li>**Tool support** – CLI tools (e.g., `apksigner`) expose options such as `--output-lineage-file` and `--lineage-file`, which internally call `writeToFile` or `readFromFile`.  <li>**Cross‑APK comparison** – `consolidateLineages()` is used when an APK contains multiple V3 signatures (e.g., from a legacy V2 signer plus a new V3 signer) to merge the lineages into a single coherent chain. </ul>  The lineage is essential for Android’s “certificate‑rollover” feature: the platform can still accept an APK signed with a newer certificate as long as the lineage includes a chain that leads back to the original certificate that the device had cached for that app.  Therefore this class sits at the heart of the APK‑signature‑verification logic. |

**Take‑away**  
`SigningCertificateLineage` is the central representation of the chain of signing certificates for an APK.  It is both *used* by the signer to generate the correct binary format and *read* by the verifier to enforce the certificate‑rollover rules.  Because it underpins V3 signing and the related tooling, it is a core component of the Android APK‑signing library.